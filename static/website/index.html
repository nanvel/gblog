<!DOCTYPE html>
<html lang="en" data-ng-app="gblog">
    <head>
        <meta charset="utf-8"/>
        <title>Blog - Oleksandr Polieno</title>
    </head>
    <body data-ng-controller="PageCtrl">
        <ul class="menu">
            <li><a href="#/">Feed</a></li>
        </ul>
        <div data-ng-view="">
        </div>
        <script src="libs/angular/angular.min.js"></script>
        <script src="libs/angular-resource/angular-resource.min.js"></script>
        <script src="libs/angular-route/angular-route.min.js"></script>
        <script>
            var app = angular.module('gblog', ['ngResource', 'ngRoute']);

            app.config(function($routeProvider) {
                $routeProvider.when('/', {
                    templateUrl: 'views/feed.html',
                    controller: 'FeedCtrl',
                }).when('/post/:timestamp', {
                    templateUrl: 'views/post.html',
                    controller: 'PostCtrl',
                }).otherwise({
                    redirectTo: '/'
                })
            });

            app.factory('Post', function($resource) {
                return $resource('/post', {});
            });

            app.controller('PageCtrl', function($scope) {
            });

            app.controller('FeedCtrl', function($scope, Post) {
                Post.get(function(data) {
                    $scope.first = data.first;
                    $scope.last = data.last;
                    $scope.posts = data.posts;
                });
                $scope.showPreviousItems = function() {
                    Post.get({'b': $scope.last}, function(data) {
                        $scope.first = data.first;
                        $scope.last = data.last;
                        $scope.posts = data.posts;
                    });
                }
                $scope.showNextItems = function() {
                    Post.get({'a': $scope.first}, function(data) {
                        $scope.first = data.first;
                        $scope.last = data.last;
                        $scope.posts = data.posts;
                    });
                }
            });

            app.controller('PostCtrl', function($scope, $routeParams, Post) {
                Post.get({t: $routeParams['timestamp']}, function(data) {
                    $scope.post = data.posts[0];
                });
            });

            app.filter('safe_html', ['$sce', function($sce){
                return function(text) {
                    return $sce.trustAsHtml(text);
                };
            }]);
        </script>
    </body>
</html>
